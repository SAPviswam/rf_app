sap.ui.define(["./BaseController","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,s){"use strict";return e.extend("com.app.rfapp.controller.Home",{onInit:function(){this.bOtpVerified=false},onLoginPress:async function(){var e=this.getView();var t=e.byId("idHUInput").getValue();var a=e.byId("idUserIDInput").getValue();var r=e.byId("idPasswordInput").getValue();if(!t){s.show("Please enter the Warehouse Number.");return}if(!a){s.show("Please enter the Resource ID.");return}if(!r){s.show("Please enter the Password.");return}if(a==="111010"&&r==="ARTIHCUS"){this.getRouter().navTo("Supervisor");return}var o=this.getOwnerComponent().getModel();var i=this;try{await o.read("/RESOURCESSet('"+a+"')",{success:function(t){if(t.Resourceid===a&&t.Password===r){if(t.Loginfirst===false){sap.m.MessageToast.show("Welcome! It seems this is your first login.");i.sample()}else{sap.m.MessageToast.show("Welcome back!");i.getRouter().navTo("RouteResourcePage",{id:a})}e.byId("idUserIDInput").setValue("");e.byId("idPasswordInput").setValue("")}else{s.show("Invalid Resource ID or Password.")}}.bind(this),error:function(){s.show("User does not exist.")}})}catch(e){s.show("An error occurred while checking the user.")}},onClearPress:function(){var e=this.getView();e.byId("idUserIDInput").setValue("");e.byId("idPasswordInput").setValue("")},onPressSignupBtn:async function(){this.oSignupForm??=await this.loadFragment({name:"com.app.rfapp.fragments.SignUpDetails"});this.oSignupForm.open()},onCloseRegisterSubmitDialog:function(){this.oSignupForm.close()},onVerify:function(){var e=this.byId("idInputPhoneNumber").getValue();if(!e){sap.m.MessageToast.show("Please enter a valid phone number.");return}var t="+91"+e;const s="AC417cceab51088e0d10bec28680eed7ab";const a="1dd160a8637eeeec9cdbfe53c22e8610";const r="VAdad9553b34304e96322f401d16e47a85";const o=`https://verify.twilio.com/v2/Services/${r}/Verifications`;const i={To:t,Channel:"sms"};var n=this;$.ajax({url:o,type:"POST",headers:{Authorization:"Basic "+btoa(s+":"+a),"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i),success:function(e){console.log("OTP sent successfully:",e);sap.m.MessageToast.show("OTP sent successfully! Please check your phone.");n.byId("idOtpInput").setVisible(true);this._storedPhoneNumber=t}.bind(this),error:function(e,t,s){console.error("Error sending OTP:",s);sap.m.MessageToast.show("Failed to send OTP: "+s)}})},handleEscape:function(){this.byId("idOtpDialog").close()},onSubmitOtp:function(){var e=this.byId("idInputPhoneNumber");var t=this.byId("idOtpInput");var s=this.byId("verficationId");var a=this.byId("VerifyButton");var r=t.getValue();t.setValueState(sap.ui.core.ValueState.None);t.setValueStateText("");if(!r){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Please enter the OTP.");sap.m.MessageToast.show("Please enter the OTP.");return}var o=/^\d{6}$/;if(!o.test(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Please enter a valid 6-digit OTP.");sap.m.MessageToast.show("Please enter a valid 6-digit OTP.");return}const i="AC417cceab51088e0d10bec28680eed7ab";const n="1dd160a8637eeeec9cdbfe53c22e8610";const u="VAdad9553b34304e96322f401d16e47a85";const d=`https://verify.twilio.com/v2/Services/${u}/VerificationCheck`;const l={To:this._storedPhoneNumber,Code:r};$.ajax({url:d,type:"POST",headers:{Authorization:"Basic "+btoa(i+":"+n),"Content-Type":"application/x-www-form-urlencoded"},data:$.param(l),success:function(r){if(r.status==="approved"){sap.m.MessageToast.show("OTP verified successfully!");t.setValueState(sap.ui.core.ValueState.Success);e.setValueState(sap.ui.core.ValueState.Success);e.setEditable(false);s.setVisible(true);a.setVisible(false);t.setValueStateText("OTP verified successfully");this.bOtpVerified=true}else{t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Invalid OTP. Please try again.");sap.m.MessageToast.show("Invalid OTP. Please try again.");e.setValueState(sap.ui.core.ValueState.Error);e.setValueStateText("Recheck your Mobile Number")}}.bind(this),error:function(e,t,s){console.error("Error verifying OTP:",s);sap.m.MessageToast.show("Failed to verify OTP: "+s)}})},onSubmitPress:function(){var e=this.getView();var a=this.byId("idResouceType").getSelectedKey();var r=true;var o=true;var i=e.byId("idResourceIdInput").getValue();var n=e.byId("idUserNameInput").getValue();var u=e.byId("idInputEmail").getValue();var d=e.byId("idInputPhoneNumber").getValue();if(!a){e.byId("idResouceType").setValueState("Error");e.byId("idResouceType").setValueStateText("Select a valid Area");r=false;o=false}else{e.byId("idResouceType").setValueState("None")}if(!i){e.byId("idResourceIdInput").setValueState("Error");e.byId("idResourceIdInput").setValueStateText("Resource ID is mandatory");r=false;o=false}else if(!/^\d{6}$/.test(i)){e.byId("idResourceIdInput").setValueState("Error");e.byId("idResourceIdInput").setValueStateText("Resource ID must be a 6-digit numeric value");r=false}else{e.byId("idResourceIdInput").setValueState("None")}if(!n){e.byId("idUserNameInput").setValueState("Error");e.byId("idUserNameInput").setValueStateText("Username is mandatory");r=false;o=false}else{e.byId("idUserNameInput").setValueState("None")}if(!e.byId("idInputEmail").getValue()){}else if(!/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(u)){e.byId("idInputEmail").setValueState("Error");e.byId("idInputEmail").setValueStateText("Please enter a valid email address");r=false}if(!d){e.byId("idInputPhoneNumber").setValueState("Error");e.byId("idInputPhoneNumber").setValueStateText("Phone number is mandatory");r=false;o=false}else if(d.length!==10||!/^\d+$/.test(d)){e.byId("idInputPhoneNumber").setValueState("Error");e.byId("idInputPhoneNumber").setValueStateText("Mobile number must be a 10-digit numeric value");r=false}else{e.byId("idInputPhoneNumber").setValueState("None");if(!this.bOtpVerified){sap.m.MessageToast.show("Please verify your phone number with the OTP before submitting.");return}}if(!o){sap.m.MessageToast.show("Please fill all mandatory details");return}if(!r){sap.m.MessageToast.show("Please enter correct data");return}var l=this.getView().getModel();var c=this;l.read("/RESOURCESSet('"+i+"')",{success:function(e){s.show("Resource exist")}.bind(this),error:function(){l.create("/RESOURCESSet",{Resourceid:i,Resourcetype:a,Validity:false,Resourcename:n,Email:u,Phonenumber:d},{success:function(){sap.m.MessageToast.show("Success");c.onCloseRegisterSubmitDialog();c.onClearRegisterSubmitDialog()},error:function(e){var s=JSON.parse(e.responseText);t.error(s.error.message.value||"Error occurred while creating resource")}})}})},onClearRegisterSubmitDialog:function(){var e=this.getView();e.byId("idResourceIdInput").setValue("");e.byId("idUserNameInput").setValue("");e.byId("idInputEmail").setValue("");e.byId("idInputPhoneNumber").setValue("");e.byId("idInputPhoneNumber").setEditable(true);e.byId("VerifyButton").setVisible(true);e.byId("verficationId").setVisible(false);e.byId("idOtpInput").setVisible(false);e.byId("idOtpInput").setValue("");this.bOtpVerified=false;e.byId("idResouceType").setSelectedKey("")},onForgotPassword:async function(){this.oforgotDialog??=await this.loadFragment({name:"com.app.rfapp.fragments.Forgotpassword"});this.oforgotDialog.open()},onCloseFP:function(){this.oforgotDialog.close()},sample:async function(){this.oResetDialog??=await this.loadFragment({name:"com.app.rfapp.fragments.Resetpassword"});this.oResetDialog.open()},formatDate:function(e){var t=e.getFullYear();var s=("0"+(e.getMonth()+1)).slice(-2);var a=("0"+e.getDate()).slice(-2);return`${t}-${s}-${a}`},onSavePress:async function(){var e=this.getView();var s=e.byId("idResetNewPassword").getValue();var a=e.byId("idresetConfirmPassword").getValue();if(a.length!==8||s.length!==8){t.error("Your Password length should be 8 characters.");return}if(s!==a){sap.m.MessageToast.show("Passwords do not match. Please try again.");return}var r=e.byId("idUserIDInput").getValue();if(!r){t.error("Resource ID is missing.");return}var o={Loginfirst:true,Password:s};var i=this.getOwnerComponent().getModel();try{await i.update(`/RESOURCESSet('${r}')`,o,{success:function(){sap.m.MessageToast.show("Password updated successfully!");e.byId("idResetNewPassword").setValue("");e.byId("idresetConfirmPassword").setValue("");this.oResetDialog.close();e.byId("idUserIDInput").setValue("");e.byId("idPasswordInput").setValue("")}.bind(this),error:function(){sap.m.MessageToast.show("Error updating user login status.")}})}catch(e){sap.m.MessageToast.show("An error occurred while updating the password.")}},onCancelPress:function(){this.oResetDialog.close()}})});
//# sourceMappingURL=Home.controller.js.map